http://blog.csdn.net/,asibuaa/article/details/9246493
主要分为以下几个步骤：
(1) 读入两张图片并分别提取SIFT特征
(2) 利用k-d tree和BBF算法进行特征匹配查找
(3) 利用RANSAC算法筛选匹配点并计算变换矩阵
(3) 图像融合
(4) 图像变换

1.
最近几年在计算机视觉研究的各个领域可以看到对不变量特征点方法的大量使用。
不变量特征点的引入，使尺度不变特征变换（sift）成为其中最有效和最广为使用的的方法之一，并且作为该方法流行的主要刺激因素。

SIFT算法主要通过4步来检测和描述一幅图像中的局部特征，或特征点：
1、在尺度空间上检测极值点
2、亚像素定位和特征点过滤
3、分配特征点的典型方向
4、计算特征点的描述子

主要步骤 
　　1)、尺度空间的生成；
 　　2)、检测尺度空间极值点；
　　3)、精确定位极值点；
　　4)、为每个关键点指定方向参数；
　　5)、关键点描述子的生成。

2.
何谓K近邻算法，即K-Nearest Neighbor algorithm，
简称KNN算法，单从名字来猜想，
可以简单粗暴的认为是：K个最近的邻居，当K=1时，算法便成了最近邻算法，即寻找最近的那个邻居。
为何要找邻居？打个比方来说，假设你来到一个陌生的村庄，现在你要找到与你有着相似特征的人群融入他们，所谓入伙。

之前blog内曾经介绍过SIFT特征匹配算法，特征点匹配和数据库查、图像检索本质上是同一个问题，
都可以归结为一个通过距离函数在高维矢量之间进行相似性检索的问题，
如何快速而准确地找到查询点的近邻，不少人提出了很多高维空间索引结构和近似查询的算法。

    一般说来，索引结构中相似性查询有两种基本的方式：

一种是范围查询，范围查询时给定查询点和查询距离阈值，从数据集中查找所有与查询点距离小于阈值的数据
另一种是K近邻查询，就是给定查询点及正整数K，从数据集中找到距离查询点最近的K个数据，当K=1时，它就是最近邻查询。
    同样，针对特征点匹配也有两种方法：

最容易的办法就是线性扫描，也就是我们常说的穷举搜索，依次计算样本集E中每个样本到输入实例点的距离，然后抽取出计算出来的最小距离的点即为最近邻点。此种办法简单直白，但当样本集或训练集很大时，它的缺点就立马暴露出来了，举个例子，在物体识别的问题中，可能有数千个甚至数万个SIFT特征点，而去一一计算这成千上万的特征点与输入实例点的距离，明显是不足取的。
另外一种，就是构建数据索引，因为实际数据一般都会呈现簇状的聚类形态，因此我们想到建立数据索引，
然后再进行快速匹配。索引树是一种树结构索引方法，其基本思想是对搜索空间进行层次划分。
根据划分的空间是否有混叠可以分为Clipping和Overlapping两种。前者划分空间没有重叠，其代表就是k-d树；后者划分空间相互有交叠，其代表为R树。

 BBF算法，在KD-tree上找KNN ( K-nearest neighbor)
BBF(Best Bin First)算法，借助优先队列（这里用最小堆）实现

这个算法也是数据挖掘中经典的聚类算法。
Kd-tree 特征点数据库的形成：
对一幅图上的SIFT特征点与另一幅图上的特征点或者大量的特征点数据库进行有效地匹配是基本的功能。
在文章[1]中，Beis和Lowe提出一种方法来促进有效地特征点匹配，
通过使用kd-tree和最近邻搜索的近似（拥有非常高的正确率）。

不变图像特征处理：
最后，SIFT库也包含了一系列结果和方法来处理不变图像特征数据，
包括由其他软件产生的数据。
尤其，库的这部分包含了一个数据结构来表示图像特征数据以及提供了方法来导入和导出使用库自己的SIFT方法所计算的特征点，
也可以导入Lowe的算法所计算的特征点以及牛津大学视觉几何小组的软件所计算的仿射协变特征点。
利用这种功能性（在i,gfeatures.h头文件里），kd-tree和Ransac算法可以应用于以上各个特征点类型。

3.
这两个文件中实现了RANSAC算法(RANdo, SAmple Consensus 随机抽样一致)。
RANSAC算法可用来筛选两个图像间的SIFT特征匹配并计算变换矩阵。
你可以单纯利用RANSAC算法筛选两个图像间的SIFT特征匹配，以得到更好的匹配结果，

RANSAC (Random Sample Consensus, 随机抽样一致)  (from wiki)
该算法做什么呢？呵呵，用一堆数据去搞定一个待定模型，这里所谓的搞定就是一反复测试、迭代的过程，
找出一个error最小的模型及其对应的同盟军（consensus set）。
用在我们的SIFT特征匹配里，就是说找一个变换矩阵出来，使得尽量多的特征点间都符合这个变换关系。

  模型参数估计方法，如经典的最小二乘法，
  可以根据某种给定的目标方程估计并优化模型参数以使其最大程度适应于所有给定的数据集。
  这些方法都没有包含检测并排除异常数据的方法，他们都基于平滑假设：忽略给定的数据集的大小，
  总有足够多的准确数据值来消除异常数据的影响。但是在很多实际情况下，平滑假设无法成立，
  数据中可能包含无法得到补偿的严重错误数据，这时候此类模型参数估计方法将无法使用。
      例如如下情况：给定7个点（如图1所示），如何拟出一条最合适的直线段，
	  使得所有的正确点到直线的距离不超过0.8。此时显然无法使用最小二乘法等方法进行拟合。

4.
图像融合：另一种方法首先也是将右图img2经变换矩阵H变换到一个新图像中，然后图像的融合过程将目标图像分为三部分，
最左边完全取自img1中的数据，中间的重合部分是两幅图像的加权平均，
重合区域右边的部分完全取自img2经变换后的图像。加权平均的权重选择也有好多方法，
比如可以使用最基本的取两张图像的平均值，但这样会有明显的拼接缝。这里首先计算出拼接区域的宽度，
设d1，d2分别是重叠区域中的点到重叠区域左边界和右边界的距离，则使用如下公式计算重叠区域的像素值：


改进调研：

：颜色特征是一种全局特征,
描述了图像或图像区域所对应的景物的表面性质
。一般颜色特征是基于像素点的特征，此时所有属于图像或图像区域的像素都有各自的贡献。
由于颜色对图像或图像区域的方向、大小等变化不敏感，所以颜色特征不能很好地捕捉图像中对象的局部特征。
另外，仅使用颜色特征查询时，如果数据库很大，常会将许多不需要的图像也检索出来。
颜色直方图是最常用的表达颜色特征的方法，其优点是不受图像旋转和平移变化的影响，
进一步借助归一化还可不受图像尺度变化的影响，基缺点是没有表达出颜色空间分布的信息

局部不变特征是近年来计算机视觉领域的研究热点。
局部不变特征在宽基线匹配、特定目标识别、目标类别识别、图像及视频检索、机器人导航、场景分类、纹理识别和数据挖掘等多个领域得到了广泛的应用。

局部不变特征是指局部特征的检测或描述对图像的各种变化,
例如几何变换、光度变换、卷积变换、视角变化等保持不变。
局部不变特征的基本思想是提取图像内容的本质属性特征,这些特征与图像内容的具体表现形式无关或具有自适应性(即表现形式变化时特征提取自适应的变化以描述相同的图像内容)。
局部不变特征通常存在一个局部支撑邻域,与经典的图像分割算法不同,
局部支撑邻域可能是图像的任何子集,支撑区域的边界不一定对应图像外观(例如颜色或纹理)的变化。

局部不变特征不仅能够在观测条件变化大、
遮挡和杂乱干扰的情况下获得可靠的匹配,
而且能够有效的描述图像内容进行图像检索或场景、目标识别等。
局部不变特征可以克服语义层次图像分割的需要。
从复杂背景中分割出前景目标是十分困难的课题,
基于低层特征的方法很难实现有意义的分割,
把图像内容表示为局部不变区域的集合(多个区域可能存在重合,图像中一些部分也可能不存在局部不变区域),可以回避分割问题。
基于局部不变特征的方法本质上是对图像内容进行隐式分割,
局部不变特征既可能位于感兴趣的前景目标上也可能位于背景或目标边界上,后续的高层处理需要基于局部不变特征提取感兴趣的信息。

SIFT 算法是多尺度空间理论提出后产生的 , 对图像
的 局 部 特 征 进 行 提 取 ,SIFT 描 述 子 对 于 旋 转 、 尺 度 缩
放、仿射变换、视角的变换具有很好的稳定性(对大多数
图像尺度变换、旋转、仿射变换等具有很强的不变性(基
于颜色不变特性的彩色描述子不仅保留了 SIFT 原有特
性 ,可以 获得 更 高 的 辨 别 率,而 且 对 于 光 照 的 变 化 也 保
持了很好的不变性.

以下是比较普通的
首先介绍一下流程：
    1.选图，两张图的重叠区域不能太小，我个人认为最少不少于15%，这样才能保证有足够的角点匹配。
    2.角点检测。这一步OpenCV提供了很多种方法，譬如Harris角点检测，而监测出的角点用CvSeq存储，这是一个双向链表。
    3.角点提纯。在提纯的时候，需要使用RANSAC提纯。OpenCV自带了一个函数，FindHomography，不但可以提纯，还可以计算出3x3的转换矩阵。这个转换矩阵十分重要。
    4.角点匹配。经过提纯后的角点，则需要匹配。
    5.图像变换。这一步我曾经尝试过很多办法，最后选择了FindHomography输出的变换矩阵，这是一个透视变换矩阵。经过这个透视变换后的图像，可以直接拿来做拼接。
    6.图象拼接。完成上面步骤之后，其实这一步很容易。
    7.球面变换。这一步需要对坐标系进行转换，从平面坐标到球面坐标。
	
SIFT（Scale Invariant Feature Transform）是其中应用最广的，它在1999年D. Lowe首次提出，至2004年得到完善。
SIFT的提出也是局部图像特征描述子研究领域一项里程碑式的工作。
由于SIFT对尺度、旋转以及一定视角和光照变化等图像变化都具有不变性，并且SIFT具有很强的可区分性，自它提出以来，
很快在物体识别、宽基线图像匹配、三维重建、图像检索中得到了应用，
局部图像特征描述子在计算机视觉领域内也得到了更加广泛的关注，涌现了一大批各具特色的局部图像特征描述子。
